## 应用层 ##

---

[toc]

---

### 什么是HTTP协议 ###

**HTTP**协议(超文本传输协议HyperText Transfer Protocol)，它是基于TCP协议的应用层传输协议，简单来说就是客户端和服务端(仅仅用来区分请求发起端和接受端)进行数据传输的一种规则。

> **HTTP** 是一种**无状态** (stateless) 协议, `HTTP`协议本身不会对发送过的请求和相应的通信状态进行持久化处理。这样做的目的是为了保持HTTP协议的简单性，从而能够快速处理大量的事务, 提高效率。(引入Cookie计数可以记录管理状态)

---

### 什么是HTTP请求 ###

> HTTP 请求由三部分组成 : HTTP请求状态行, HTTP消息报头, HTTP请求正文

<img src="https://pic2.zhimg.com/80/v2-12836e928e97f0d1acf375b34981a071_720w.jpg" alt="img" style="zoom: 67%;" /><img src="https://pic4.zhimg.com/80/v2-839818777263adb12e93aafda6595633_720w.jpg" alt="img" style="zoom: 50%;" />

1. **HTTP请求状态行**
    - 由请求`Method`, `URL` 字段和`HTTP Version`三部分构成
    - 定义了本次请求的请求方式, 请求的地址, 以及所遵循的HTTP协议版本
    - 例如 ``` GET /example.html HTTP/1.1 (CRLF)```
    - 常用`Method`:
        -  `GET`： 请求 **获取** Request-URI所标识的资源
        -  `POST` ： 在Request-URI所标识的资源后 **增加** 新的数据
        -  `HEAD`： 请求获取由Request-URI所标识的资源的 **响应消息报头**
        -  `PUT`： 请求服务器**存储或修改**一个资源，并用Request-URI作为其标识 
        -  `DELETE`： 请求服务器**删除**Request-URI所标识的资源
        -  `TRACE`： 请求服务器回送收到的请求信息，主要用于**测试或诊断**
        -  `CONNECT`： 保留将来使用
        -  `OPTIONS`： 请求查询服务器的性能，或者查询与资源相关的选项和需求
2. **HTTP消息报头**
    - 消息报头由一系列的键值对组成，允许客户端向服务器端发送一些附加信息或者客户端自身的信息
    - 主要包括:
    - <img src="https://pic2.zhimg.com/80/v2-8b50f49b69a70379a52b47060dcdf1f9_720w.jpg" alt="img" style="zoom:67%;" />
3. **HTTP请求正文**
    - 只有在发送`POST`请求时才会有请求正文，`GET`方法并没有请求正文

---

### GET 和 POST的区别 ###

| GET                                                          | POST                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| get 提交的数据会放在 URL 之后，并且请求参数会被完整的保留在浏览器的记录里<br>由于参数直接暴露在 URL 中，可能会存在安全问题，因此往往用于获取资源信息 | post 参数放在请求主体中，并且参数不会被保留<br>post 方法更安全，主要用于修改服务器上的资源 |
| get 请求只支持 URL 编码                                      | post 请求支持多种编码格式                                    |
| get 只支持 ASCII 字符格式的参数                              | post 方法没有限制                                            |
| get 提交的数据大小有限制<br>get方法是通过 URL 传递数据的，而 URL 本身并没有对数据的长度进行限制<br>限制get长度的是浏览器(例: Chrome 浏览器中 URL 最大长度限制为 8182 个字符) | POST 方法请求参数在请求主体中<br>理论上讲，post 方法是没有大小限制的<br>真正起限制作用的是服务器处理程序的处理能力 |
| get 方式需要使用 Request.QueryString 来取得变量的值          | post 方式通过 Request.Form 来获取                            |
| get 方法产生一个 TCP 数据包                                  | post 方法产生两个(部分浏览器只产生一个)<br>                  |



---

### 什么是HTTP响应 ###

![img](https://pic2.zhimg.com/80/v2-8eefa42df5c663cf259b39be57359bb1_720w.jpg)

基本类似于**请求**, 特别说明状态码如下:

状态代码有三位数字组成，第一个数字定义了响应的**类别**，且有五种可能取值：

- `1xx`：**指示信息** - 表示请求已接收，继续处理 
- `2xx`：**成功** - 表示请求已被成功接收、理解、接受 
- `3xx`：**重定向** - 要完成请求必须进行更进一步的操作
- `4xx`：**客户端错误** - 请求有语法错误或请求无法实现 
- `5xx`：**服务器端错误** - 服务器未能实现合法的请求

常见的状态码有:

- `200`： **OK** - 客户端请求成功
- `400`： **Bad Request** - 客户端请求有语法错误，不能被服务器所理解 
- `401`： **Unauthorized** - 请求未经授权，这个状态代码必须和`WWW-Authenticate`报头域一起使用
- `403`： **Forbidden** - 服务器收到请求，但是拒绝提供服务 
- `404`： **Not Found** - 请求资源不存在，eg：输入了错误的URL
- `500`： **Internal Server Error** - 服务器发生不可预期的错误 
- `503`： **Server Unavailable** - 服务器当前不能处理客户端的请求，一段时间后,可能恢复正常

---

### HTTP的五大特点 ###

1. 支持**客户/服务器**模式。
2. **简单快速**：客户向服务器请求服务时，只需传送请求方法和路径。请求方法常用的有`GET`、`HEAD`、`POST`。每种方法规定了客户与服务器联系的类型不同。由于`HTTP`协议简单，使得`HTTP`服务器的程序规模小，因而通信速度很快。
3. **灵活**：HTTP允许传输任意类型的数据对象。正在传输的类型由`Content-Type`加以标记。
4. **无连接**：无连接的含义是限制每次连接只处理一个请求。服务器处理完客户的请求，并收到客户的应答后，即断开连接。采用这种方式可以节省传输时间。早期这么做的原因是请求资源少，追求快。后来通过`Connection: Keep-Alive`实现长连接
5. **无状态**：`HTTP`协议是无状态协议。无状态是指协议对于事务处理没有记忆能力。缺少状态意味着如果后续处理需要前面的信息，则它必须重传，这样可能导致每次连接传送的数据量增大。另一方面，在服务器不需要先前信息时它的应答就较快。

---

### 什么是持久连接 什么是非持久连接 ###

> 在实际的应用中，客户端往往会发出一系列请求，接着服务器端对每个请求进行响应。
>
> - 对于这些请求|响应，如果每次都经过一个单独的TCP连接发送，称为**非持久连接**。
> - 反之，如果每次都经过相同的TCP连接进行发送，称为**持久连接**。

​	在 HTTP/1.1 版本中默认使用持久连接，在此之前的 HTTP 版本的默认连接都是使用非持久连接，如果想要在旧版本的 HTTP 协议上维持持久连接，则需要指定 connection 的首部字段的值为 Keep-Alive 来告诉对方这个请求响应完成后不要关闭

- 持久连接：多用于操作频繁，点对点的通讯，而且客户端连接数目较少的情况。例如即时通讯、网络游戏等。
- 非持久连接：用户数目较多的Web网站的 HTTP 服务一般用短连接。例如京东，淘宝这样的大型网站一般客户端数量达到千万级甚至上亿，若采用长连接势必会使得服务端大量的资源被无效占用，所以一般使用的是非持久连接。

---

### HTTP的报文长度 ###

- 当响应消息中存在 Content-Length 字段时，我们可以直接根据这个值来判断数据是否接收完成
    - 例如客户端向服务器请求一个静态页面或者一张图片时，服务器能够很清楚的知道请求内容的大小，因此可以通过消息首部字段 Content- Length 来告诉客户端需要接收多少数据
    - 但是如果服务器预先不知道请求内容的大小，例如加载动态页面的时候，就需要使用 Transfer-Encoding: chunked 的方式来代替 Content-Length
- 分块传输编码（Chunked transfer encoding）是 HTTP/1.1 中引入的一种数据传输机制，
    - 其允许 HTTP 由服务器发送给客户端的数据可以分成多个部分
    - 当数据分解成一系列数据块发送时，服务器就可以发送数据而不需要预先知道发送内容的总大小
    - 每一个分块包含十六进制的长度值和数据，最后一个分块长度值为0，表示实体结束，客户机可以以此为标志确认数据已经接收完毕

---

### HTTP 和 HTTPS的工作方式 ###

