# 数据链路层 #

---

[toc]

---

---

## 地址 ##

---

### MAC地址和IP地址分别由什么作用, 为什么不能只使用一种地址 ###

- **MAC 地址** 是数据链路层和物理层使用的地址，是写在网卡上的物理地址。MAC 地址用来定义网络设备的位置。
- **IP 地址 **是网络层和以上各层使用的地址，是一种逻辑地址。IP 地址用来区别网络上的计算机

| 地址 | 带来的问题                                                   | 引入另一种地址的作用                                         |
| ---- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| MAC  | 需要路由器记住每个 MAC 地址属于哪一个子网，不然每一次路由器收到数据包时都要在整世界范围内寻找目的 MAC 地址<br>MAC 地址的长度为 48 位，也就是说最多总共有 2 的 48 次方个 MAC 地址，这就意味着每个路由器需要 256 T 的内存，这显然是不现实的 | 和 MAC 地址不同，IP 地址是和地域相关的<br>在一个子网中的设备，我们给其分配的 IP 地址前缀都是一样的<br>这样路由器就能根据 IP 地址的前缀知道这个设备属于哪个子网，剩下的寻址就交给子网内部实现，从而大大减少了路由器所需要的内存 |
| IP   | 只有当设备连入网络时，才能根据他进入了哪个子网来为其分配 IP 地址<br>在设备还没有 IP 地址的时候或者在分配 IP 地址的过程中我们无法利用IP地址 | MAC 地址来区分不同的设备                                     |

---

### ARP的原理和过程 ###

> **ARP（Address Resolution Protocol）**是地址解析协议的缩写
>
> 该协议提供根据 IP 地址获取物理地址的功能，
>
> 它工作在第二层，是一个数据链路层协议，其在本层和物理层进行联系，同时向上层提供服务

​	当通过以太网发送 IP 数据包时，需要先封装 32 位的 IP 地址和 48位 MAC 地址。

​	在局域网中两台主机进行通信时需要依靠各自的物理地址进行标识，但由于发送方只知道目标 IP 地址，不知道其 MAC 地址，因此需要使用地址解析协议

​	其工作过程如下:

1. 每个主机都会在自己的 ARP 缓冲区中建立一个 ARP 列表，以表示 IP 地址和 MAC 地址之间的对应关系
2. 当源主机要发送数据时，首先检查 ARP 列表中是否有 IP 地址对应的目的主机 MAC 地址
    - 如果存在，则可以直接发送数据
    - 否则就向同一子网的所有主机发送 ARP 数据包, 该数据包包括的内容有源主机的 IP 地址和 MAC 地址，以及目的主机的 IP 地址
3. 当本网络中的所有主机收到该 ARP 数据包时，首先检查数据包中的 目的 主机IP 地址是否是自己的 IP 地址
    - 如果不是，则忽略该数据包
    - 如果是
        - 首先从数据包中取出源主机的 IP 和 MAC 地址写入到 ARP 列表中，如果已经存在，则覆盖
        - 将自己的 MAC 地址写入 ARP 响应包中，告诉源主机自己是它想要找的 MAC 地址
4. 源主机收到 ARP 响应包后。将目的主机的 IP 和 MAC 地址写入 ARP 列表，并利用此信息发送数据
    - 如果源主机一直没有收到 ARP 响应数据包，表示 ARP 查询失败